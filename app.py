import streamlit as st
import pandas as pd

# ุฅุนุฏุงุฏ ุงูุตูุญุฉ
st.set_page_config(page_title="ูุธุงู ุงูุงุณุชุนูุงู ุงูุดุงูู", layout="wide")

# ุฏุงูุฉ ูุชูุญูุฏ ุงููุตูุต (ุฅุฒุงูุฉ ุงูููุฒุงุช ููุจุญุซ)
def normalize_text(text):
    if pd.isna(text):
        return ""
    text = str(text)
    # ุงุณุชุจุฏุงู ูู ุฃุดูุงู ุงูุฃูู ุจู ุง
    for char in ['ุฃ', 'ุฅ', 'ุข']:
        text = text.replace(char, 'ุง')
    # ุงุณุชุจุฏุงู ุงููุงุก ุงููุชุทุฑูุฉ ู ุจู ู (ุงุฎุชูุงุฑู ูู ุญุงุจุจ)
    text = text.replace('ู', 'ู')
    return text

st.title("๐ ุงุจุญุซ ุนู ุงููุนูู ุฃู ุงููุฏุฑุณุฉ")
st.markdown("---")

try:
    # ูุฑุงุกุฉ ุงูููู
    df = pd.read_excel("data.xlsx")
    
    # ุชุญุถูุฑ ุฃุนูุฏุฉ ุฎููุฉ ููุจุญุซ (ูุณุฎ ูู ุงูุจูุงูุงุช ุจุฏูู ููุฒุงุช)
    # ุฏู ุนุดุงู ููุง ูุจุญุซ ุนู "ุงุญูุฏ" ููุงูู "ุฃุญูุฏ" ูุงูุนูุณ
    df['search_name'] = df['ุงุณู ุงููุนูู'].apply(normalize_text)
    df['search_school'] = df['ุงุณู ุงููุฏุฑุณุฉ'].apply(normalize_text)

    # ุฎุงูุฉ ุงูุจุญุซ
    query = st.text_input("ุงูุชุจ ุงุณู ุงููุนูู ุฃู ุงุณู ุงููุฏุฑุณุฉ:", placeholder="ูุซุงู: ุฃุญูุฏ ูุญูุฏ / ูุฏุฑุณุฉ ุชูุฏุฉ")

    if query:
        # ุชูุธูู ูููุฉ ุงูุจุญุซ ุงููู ูุชุจูุง ุงููุณุชุฎุฏู ุจุฑุถู
        search_term = normalize_text(query)
        
        # ุงูุจุญุซ: ูู ุงูุงุณู ููุฌูุฏ ูู (ุงุณู ุงููุนูู) ุ -ุฃู- ูู ููุฌูุฏ ูู (ุงุณู ุงููุฏุฑุณุฉ)ุ
        # ุงูุนูุงูุฉ | ูุนูุงูุง OR
        mask = df['search_name'].str.contains(search_term, case=False) | \
               df['search_school'].str.contains(search_term, case=False)
        
        result = df[mask]
        
        if not result.empty:
            st.success(f"ุชู ุงูุนุซูุฑ ุนูู {len(result)} ูุชูุฌุฉ:")
            # ุนุฑุถ ุงูุฃุนูุฏุฉ ุงููููุฉ ููุท (ุจูุง ูููุง ุงูุนููุฏ ุงูุฌุฏูุฏ 'ุงูุญุงูุฉ')
            st.table(result[['ุงุณู ุงููุนูู', 'ุงุณู ุงููุฏุฑุณุฉ', 'ุงูุญุตุต ุงููุนููุฉ ุงูุฃุณุจูุนูุฉ', 'ุงููุทุงุน', 'ุงูุญุงูุฉ']])
        else:
            st.warning("ูู ูุชู ุงูุนุซูุฑ ุนูู ูุชุงุฆุฌ ูุทุงุจูุฉ. ุฌุฑุจ ูุชุงุจุฉ ุฌุฒุก ูููุฒ ูู ุงูุงุณู.")

except Exception as e:
    st.error("ุญุฏุซ ุฎุทุฃ ูู ูุฑุงุกุฉ ุงููููุ ุชุฃูุฏ ูู ูุฌูุฏ data.xlsx")
    st.error(e)
